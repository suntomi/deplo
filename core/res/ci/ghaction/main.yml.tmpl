name: Deplo CI/CD

on: 
{entrypoint:>2}
  workflow_dispatch:
    inputs:
      deplo_job_name:
        description: The name of the job to run
        requred: true
env:
  DEPLO_CI_PULL_REQUEST_URL: ${{{{ github.event.pull_request.url }}}}
  DEPLO_CI_RUN_JOB_NAME: ${{{{ github.event.inputs.deplo_job_name }}}}
{secrets:>2}
jobs:
  deplo-main:
    name: Start CI
    runs-on: ubuntu-latest
    container: {image}:{tag}
    outputs:
{outputs:>6}
    steps:
{checkout:>6}
      - name: Start deplo
        id: deplo-ci-kick
        run: deplo ci kick
      - name: Setup ssh session to debug
        if: ${{{{ failure() }}}}
        uses: umegaya/action-tmate@132a4fe73c61b3459556a7c1baf1eefc8c3e15d2
        with:
          sudo: false
  deplo-finish:
    name: Cleanup CI
    needs: [{needs}]
    runs-on: ubuntu-latest
    container: {image}:{tag}
    steps:
{checkout:>6}
      - name: Cleanup deplo
        id: deplo-ci-fin
        run: deplo ci fin
      - name: Setup ssh session to debug
        if: ${{{{ failure() }}}}
        uses: umegaya/action-tmate@132a4fe73c61b3459556a7c1baf1eefc8c3e15d2
        with:
          sudo: false
{jobs:>2}