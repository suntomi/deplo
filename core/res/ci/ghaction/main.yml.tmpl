# generated by deplo CLI https://github.com/suntomi/deplo don't edit by hand.
name: Deplo CI/CD

on: 
{entrypoint:>2}
  repository_dispatch:
    types: [{remote_job_dispatch_type}]

env:
  DEPLO_GHACTION_CI_ID: ${{{{ github.run_id }}}}-${{{{ github.run_attempt }}}}
  DEPLO_GHACTION_PR_URL: ${{{{ github.event.pull_request.url }}}}
  DEPLO_GHACTION_EVENT_TYPE: ${{{{ github.event.action }}}}
  DEPLO_GHACTION_EVENT_PAYLOAD: ${{{{ toJSON(github.event.client_payload) }}}}
  DEPLO_OVERWRITE_COMMIT: ${{{{ github.event.client_payload.commit }}}}
  DEPLO_OVERWRITE_RELEASE_TARGET: ${{{{ github.event.client_payload.release_target }}}}
  DEPLO_OVERWRITE_VERBOSITY: ${{{{ github.event.client_payload.verbosity }}}}
  DEPLO_OVERWRITE_WORKFLOW: ${{{{ github.event.client_payload.workflow }}}}
{secrets:>2}
jobs:
  deplo-main:
    name: Start CI ${{{{ github.event.client_payload.job_id }}}}
    runs-on: ubuntu-latest
    outputs:
      DEPLO_OUTPUT_OVERWRITE_COMMIT: ${{{{ steps.deplo-ci-kick.outputs.DEPLO_OUTPUT_OVERWRITE_COMMIT }}}}
{outputs:>6}
    steps:
{fetchcli:>6}
{checkout:>6}
      - name: Start deplo
        id: deplo-ci-kick
        run: deplo ci kick
      - name: Setup ssh session to debug
        if: ${{{{ failure() }}}}
        uses: umegaya/action-tmate@a3d459813f3429bd95fc48bcd980b2fb40f10ad0
        with:
          sudo: true
  deplo-finish:
    name: Cleanup CI
    if: ${{{{ !failure() && ({need_cleanups}) }}}}
    needs: [{needs}]
    runs-on: ubuntu-latest
{cleanup_envs:>4}
    steps:
{fetchcli:>6}
{checkout:>6}
      - name: Cleanup deplo
        id: deplo-ci-fin
        run: deplo ci fin
{debugger:>6}
{jobs:>2}